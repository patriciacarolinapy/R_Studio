---
title: ""
author: ""
format:
  html:
    toc: true
    toc-expand: true
    toc-depth: 4
    toc-location: left
    number-sections: true
    self-contained: true
    code-fold: true
    output-file: "ESM"
editor_options: 
  chunk_output_type: console
execute: 
  warning: false
  message: false
  echo: true
---

# Project Setup

```{r}
#| label:  setup

source('https://inkaverse.com/setup.r')
```

# Data import

```{r}
gs <- "https://docs.google.com/spreadsheets/d/15r7ZwcZZHbEgltlF6gSFvCTFA-CFzVBWwg3mFlRyKPs/edit?gid=172957346#gid=172957346" %>% 
  as_sheets_id()

fb <- gs %>% 
  range_read(ss = .,sheet = "fb")
```

# Análisis de datos

1. Hacer mi diseño experimental
2. Colectar mis datos
3. Importar los datos
4. Identificar el modelo estadistico
5. Analisis de Variancia (ANOVA o ANVA)
6. Prueba de comparación de medias
7. Graficar

# Área foliar

$$y = \mu + Tratamiento + e$$

$$y = \mu + Tratamiento + bloque + e$$

$$lfa = \mu + riego + geno + riego*geno + bloque + e$$

## anova

```{r}
str(fb)

md <- aov(formula = lfa ~ bloque + riego + geno + riego*geno, data = fb)

?aov

anova(md)
```

utilizando el objeto md hacer la comparación de medias de riego por genotipo usando el paquete emmeans y incluir la letras de significancia

```{r}
md <- aov(lfa ~ bloque + riego*geno, fb)

anova

library(emmeans)

em <- emmeans(md, pairwise ~ riego | geno) %>% cld(., adjust = "tukey", Letters = letters)
```

## grafico

utilizando el objeto em hacer un grafico de barras usando ggplot2 donde en el eje x esten los geno agrupados por riego y incluir la significancia

```{r}
ggplot(em, aes(x = geno, y = emmean, fill = riego)) +
  geom_col(position = position_dodge(width = 0.9)) +
  geom_errorbar(aes(ymin = lower.CL, ymax = upper.CL), position = position_dodge(width = 0.9), width = 0.2) +
  geom_text(aes(label = .group, y = upper.CL), position = position_dodge(width = 0.9), vjust = -0.5) +
  scale_fill_manual(values = c("irrigado" = "blue", "sequia" = "red")) +
  labs(x = "Genotipo", y = "Área foliar (cm²)", fill = "Riego")
```






